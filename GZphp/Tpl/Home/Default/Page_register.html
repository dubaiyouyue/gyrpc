{__NOLAYOUT__}
<include file="Home:headerno"/>
<script src="/js/birthday.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/geo.js"></script>

<!--提示层-->
    <script src="/js/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="/css/sweetalert2.min.css">
<!--end-->

<!---------------------------------------- dlbox开始 ---------------------------------------->
<div class="zcbox">
 <div class="contentbox clearfix">
      <div class="zhucebox">
        <div class="zhucebox-title">会员注册</div>
        <form action="/index.php?g=Home&m=Register" method="POST" name="myform" id="myform">
           <div class="hangbox liedui1 clearfix">
              <ul>
                <li class="lie1">
                  <div class="nickname-quyu">
                    <span class="biaoti"><font color="red">*</font>昵称：</span>
                    <span class="kuang"><input type="text" name="nicheng" id="nicheng" class="textbox_txt" value="" placeholder="不超过25个字符"></span>
                  </div>
                </li>
                <li class="lie2">
                  <div class="realname-quyu">
                   <span class="biaoti"><font color="red">*</font>真实姓名：</span>
                   <span class="kuang"><input name="name" id="name" type="text" class="textbox_txt" id=""></span>
                  </div>
                </li>
              </ul>
           </div>
           
           <div class="hangbox liedui2 clearfix">
              <ul>
                <li class="lie1">
                  <div class="tel-quyu">
                    <span class="biaoti"><font color="red">*</font>手机号码：</span>
                    <span class="kuang"><input type="text" name="tel" id="tel" class="textbox_txt" value=""></span>
                  </div>
                </li>
                <li class="lie2">
                  <div class="sex-quyu">
                     <span class="biaoti">性别：</span>
                     <span class="kuang">                  
                       <label for="RadioGroup1_0">
                         <input type="radio" name="sex" value="男" id="RadioGroup1_0">
                         男</label>
                       <label for="RadioGroup1_1">
                         <input type="radio" name="sex" value="女" id="RadioGroup1_1">
                         女</label>
                     </span>
                  </div>
                </li>
              </ul>
           </div>
           
           <div class="hangbox liedui3 clearfix">
              <ul>
                <li class="lie1">
                  <div class="email-quyu">
                    <span class="biaoti"><font color="red">*</font>邮箱：</span>
                    <span class="kuang"><input type="text" name="email" id="email" class="textbox_txt" value=""></span>
                  </div>
                </li>
                <li class="lie2">
                  <div class="birthday-quyu">
                     <span class="biaoti">生日：</span>
                     <span class="kuang"> 
                        <select name="srn" size="1" class="Choice_txt1" id="sel_year"><!--rel="1990"-->
                          <option>年</option>
                        </select>
                       <select name="sry" size="1" class="Choice_txt2" id="sel_month">
                         <option>月</option>
                       </select>
                       <select name="srr" size="1" class="Choice_txt2" id="sel_day">
                         <option>日</option>
                       </select>
                     <span style="font-size:13px; color:#bbb;">(出生年份为保密)</span>
                    </span>
                  </div>
                </li>
              </ul>
           </div>
           
           <div class="hangbox liedui4 clearfix">
              <ul>
                <li class="lie1">
                  <div class="password-quyu">
                    <span class="biaoti"><font color="red">*</font>密码：</span>
                    <span class="kuang"><input type="password" name="pass" maxlength="16" id="pass" class="textbox_txt" placeholder="6-16个字符，区分大小写" value=""></span>
                  </div>
                </li>
                <li class="lie2">
                  <div class="area-quyu">
                     <span class="biaoti">所在地：</span>
                     <span class="kuang"> 
                        <select name="szds" size="1" class="Choice_txt3" id="address-s1">
                          <option>请选择省</option>
                        </select>
                       <select name="szdsq" size="1" class="Choice_txt4" id="address-s2">
                         <option>请选择市</option>
                       </select>
                       <select name="szdq" size="1" class="Choice_txt4" id="address-s3">
                         <option>请选择区</option>
                       </select>
                    </span>
                  </div>
                </li>
              </ul>
           </div>
          
           <div class="hangbox liedui5 clearfix">
              <ul>
                <li class="lie1">
                  <div class="confirmpassword-quyu">
                    <span class="biaoti"><font color="red">*</font>确认密码：</span>
                    <span class="kuang"><input type="password" maxlength="16" name="pass2" id="pass2" class="textbox_txt" value=""></span>
                  </div>
                </li>
                <li class="lie2">
                  <div class="area-quyu">
                     <span class="biaoti">家乡：</span>
                     <span class="kuang"> 
                        <select name="jxs" size="1" class="Choice_txt3" id="address-s4">
                          <option>请选择省</option>
                        </select>
                       <select name="jxss" size="1" class="Choice_txt4" id="address-s5">
                         <option>请选择市</option>
                       </select>
                       <select name="jxq" size="1" class="Choice_txt4" id="address-s6">
                         <option>请选择区</option>
                       </select>
                    </span>
                  </div>
                </li>
              </ul>
           </div>
          
           <div class="hangbox liedui6 clearfix" style="width:288px; border:1px solid #B9B9C8; margin-bottom:20px; margin-left:80px;">
              <div class="code-quyu" style=" float:left;"><input type="text" id="yzm" name="yzm" class="textbox_txt" style="width:178px; border:none;" value="" placeholder="验证码"></div>
              <div class="yzbg-rg" style="background:#B9B9C8; width:100px; height:30px; display:block; float:right;"><img src="{:U('Home/Index/verify')}" id="verifyImage" onclick="javascript:resetVerifyCode();" width="100%" height="100%"></div>
              
           </div>
           
           <div class="hangbox liedui7 clearfix" style="width:288px;border:1px solid #B9B9C8; margin-bottom:20px; margin-left:80px;">
              <div class="code-quyu" style="float:left;"><input type="text" id="dxyzm" name="dxyzm" class="textbox_txt" style="width:144px; border:none;" value="" placeholder="短信验证码"></div>
              <div class="yzbg-rg" style="width:117px;float:right;display:block; height:30px; line-height:30px; border-left:1px solid #B9B9C8; font-size:13px; padding-left:8px; padding-right:8px;"><a style="cursor: pointer;display: block;text-align: center;" id="cxhqdxyzm" onclick="checkedformdx();">点击获取短信验证码</a></div>
              
           </div>
           
           <div class="zhucebtn"><a onclick="checkedform();" id="cxhqdxyzmcxhqdxyzm" style="display: block;cursor: pointer;">注 册</a></div>
           <P class="yiyou"><a href="/index.php/login/">已经有帐号？直接登录</a></P>
        </form>
      </div>
  </div>
</div>
<!---------------------------------------- dlbox结束 ---------------------------------------->
<!--提示层代码开始-->
<link rel="stylesheet" href="/css/animate.min.css">
<script type="text/javascript" src="/js/tishicengjsqiu.js"></script>
<script>
	function tishicengjsqiuonclick(textwz,nicheng){
		$('body').tishicengjsqiu({
			textwz:  textwz, //提示层文字 支持html
			tishicbj: '#ff662d', //提示层背景 #ddd
			colors: '#fff', //文字颜色
			iddtt:2, //自动关闭时间秒
			admmint:'flipInX', //显示动画
			//动画属性说明
			admmout:'zoomOut' //隐藏动画
		});
		document.getElementById(nicheng).focus();
	}

<!--提示层代码结束-->

//获取手机号、邮箱是否被注册
function hqsjhyxx(shoujihao,yx,code,mm){
	var er;
	$.ajax( {
		url: '/index.php?g=Home&m=Register&tel='+shoujihao+'&yx='+yx+'&code='+code+'&mm='+mm, //这里是静态页的地址
		type: "GET", //静态页用get方法，否则服务器会抛出405错误
		//dataType: "json",
		//cache: false,
		async: false,
		beforeSend: function(){
		 // Handle the beforeSend event
		},
		success: function(data){
			er=data;
			//var result = $(data).find("另一个html页面的指定的一部分").html();
		}
	});
	return er;
}


//生日日期选择
$(function () {
	$.ms_DatePicker({
            YearSelector: "#sel_year",
            MonthSelector: "#sel_month",
            DaySelector: "#sel_day"
    });
	$.ms_DatePicker();
}); setup();
function promptinfo()
{
    //var address = document.getElementById('address-address');
    var s1 = document.getElementById('address-s1');
    var s2 = document.getElementById('address-s2');
    var s3 = document.getElementById('address-s3');
    //address.value = s1.value + s2.value + s3.value;
}
//验证码
function resetVerifyCode(){
	var timenow = new Date().getTime();
	document.getElementById('verifyImage').src='/index.php?g=Home&m=Index&a=verify#'+timenow;
}
function tishi(title,text){
	swal({
	title: title,
	text: text,
	timer: 2000
	})
}
//短信发送按钮还原事件
function dxaaaa(){
	$('#cxhqdxyzm').attr("onclick","checkedformdx();");
	$('#cxhqdxyzm').html('点击获取短信验证码');
}
document.getElementById('nicheng').focus();
function checkedformdx(){
	var tel=$('#tel').val();
	var yzm=$('#yzm').val();
	var email=$('#email').val();
	if(!tel || (tel.length!=7 && tel.length!=11) || isNaN(tel)){
		/*document.getElementById('tel').focus();
		tishi('','请填写正确的手机号');*/
		tishicengjsqiuonclick('请填写正确的手机号','tel');
		return false;
	}
	if(!email || !(youxiang('email'))){
		/*document.getElementById('email').focus();
		tishi('','请填写正确的邮箱');*/
		tishicengjsqiuonclick('请填写正确的邮箱','email');
		return false;
	}
	
	if(!yzm){
		/*document.getElementById('yzm').focus();
		tishi('','请填写验证码');*/
		tishicengjsqiuonclick('请填写验证码','yzm');
		return false;
	}
	//判断手机、邮箱、验证码
	//document.getElementById("cxhqdxyzm").onclick = function(){};
	$('#cxhqdxyzm').removeAttr("onclick");
	$('#cxhqdxyzm').html('正在发送...');
	
	//var fssjdxxyyyz=hqsjhyxx(tel,email,yzm,'sjdxyzm');
	
	$.ajax( {
		url: '/index.php?g=Home&m=Register&tel='+tel+'&yx='+email+'&code='+yzm+'&mm=sjdxyzm', //这里是静态页的地址
		type: "GET", //静态页用get方法，否则服务器会抛出405错误
		//dataType: "json",
		//cache: false,
		//async: false,
		beforeSend: function(){
		 // Handle the beforeSend event
		},
		success: function(data){
			//er=data;
			if(data=='e1'){
				resetVerifyCode();
				tishicengjsqiuonclick('验证码填写错误','yzm');
				
				dxaaaa();
				return false;
			}	if(data=='e2'){
				tishicengjsqiuonclick('手机号已经注册','tel');
				dxaaaa();
				return false;
			}if(data=='e3'){
				tishicengjsqiuonclick('邮箱已经注册','email');
				dxaaaa();
				return false;
			}
			//短信验证码
			//$('#dxyzm').val(data);
			smssend();
			
			//return false;
			$('#cxhqdxyzm').html('重新发送(60秒)');
			timer(59);
			
			//var result = $(data).find("另一个html页面的指定的一部分").html();
		}
	});
	
	
	
	
	
	//alert(fssjdxxyyyz);return false;


	
	
	
}
//验证码
function smssend(){
	$.ajax( {
		url: '/sms.php', //这里是静态页的地址
		type: "GET", //静态页用get方法，否则服务器会抛出405错误
		//dataType: "json",
		//cache: false,
		//async: false,
		beforeSend: function(){
		 // Handle the beforeSend event
		},
		success: function(data){
			//var result = $(data).find("另一个html页面的指定的一部分").html();
		}
	});
}



    //倒计时
        //var intDiff = parseInt(60);//倒计时总秒数量
        function timer(intDiff){
			var intDiff = parseInt(intDiff);
            window.setInterval(function(){
            var day=0,
                hour=0,
                minute=0,
                second=0;//时间默认值        
            if(intDiff > 0){
                day = Math.floor(intDiff / (60 * 60 * 24));
                hour = Math.floor(intDiff / (60 * 60)) - (day * 24);
                minute = Math.floor(intDiff / 60) - (day * 24 * 60) - (hour * 60);
                second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
            }
			
            if (minute <= 9) minute = '0' + minute;
            if (second <= 9) second = '0' + second;
            $('#day_show').html(day);
            $('#hour_show').html(hour);
            $('#minute_show').html(minute);
           if (second!='00') $('#cxhqdxyzm').html('重新发送('+second+'秒)');
		   
            if(intDiff==0) {
				//document.getElementById("cxhqdxyzm").onclick = checkedformdx();
				$('#cxhqdxyzm').attr("onclick","checkedformdx();");
				$('#cxhqdxyzm').html('点击重新发送');
				//location.href = '<?php echo $_SESSION['dangqian_url'];?>';
			}
            intDiff--;
            }, 1000);
        } 


function checkedform(){
	var nicheng=$('#nicheng').val();
	var tel=$('#tel').val();
	var email=$('#email').val();
	var pass=$('#pass').val();
	var pass2=$('#pass2').val();
	var name=$('#name').val();
	var yzm=$('#yzm').val();
	var dxyzm=$('#dxyzm').val();
	
	if(!nicheng){
		//document.getElementById('nicheng').focus();
		//tishi('','请填写昵称');
		tishicengjsqiuonclick('请填写昵称','nicheng');
		return false;
	}
	if(!tel || (tel.length!=7 && tel.length!=11) || isNaN(tel)){
		/*document.getElementById('tel').focus();
		tishi('','请填写正确的手机号');*/
		tishicengjsqiuonclick('请填写正确的手机号','tel');
		return false;
	}
	if(!email || !(youxiang('email'))){
		/*document.getElementById('email').focus();
		tishi('','请填写正确的邮箱');*/
		tishicengjsqiuonclick('请填写正确的邮箱','email');
		return false;
	}
	if(!pass || (pass.length<6)){
		/*document.getElementById('pass').focus();
		tishi('','请填写密码');*/
		tishicengjsqiuonclick('请填写6位以上密码','pass');
		return false;
	}
	if(!pass2 || (pass2.length<6)){
		/*document.getElementById('pass2').focus();
		tishi('','请填写确认密码');*/
		tishicengjsqiuonclick('请填写6位以上确认密码','pass2');
		return false;
	}
	if(pass!=pass2){
		/*document.getElementById('pass2').focus();
		tishi('','两次密码填写不一致');*/
		tishicengjsqiuonclick('两次密码填写不一致','pass2');
		return false;
	}
	if(!name){
		/*document.getElementById('name').focus();
		tishi('','请填写真实姓名');*/
		tishicengjsqiuonclick('请填写真实姓名','name');
		return false;
	}
	if(!yzm){
		/*document.getElementById('yzm').focus();
		tishi('','请填写验证码');*/
		tishicengjsqiuonclick('请填写验证码','yzm');
		return false;
	}
	if(!dxyzm){
		/*document.getElementById('dxyzm').focus();
		tishi('','请填写短信验证码');*/
		tishicengjsqiuonclick('请填写短信验证码','dxyzm');
		return false;
	}
	
	//判断手机、邮箱、验证码
	//var fssjdxxyyyz=hqsjhyxx(tel,email,yzm+'&dxyzm='+dxyzm,'sjdxyzmzz');
	//alert(fssjdxxyyyz);return false;
	//document.getElementById("cxhqdxyzmcxhqdxyzm").onclick = function(){};
	$('#cxhqdxyzmcxhqdxyzm').removeAttr("onclick");
	$('#cxhqdxyzmcxhqdxyzm').html('正在注册...');
	
	
	$.ajax( {
		url: '/index.php?g=Home&m=Register&tel='+tel+'&yx='+email+'&code='+yzm+'&dxyzm='+dxyzm+'&mm=sjdxyzmzz', //这里是静态页的地址
		type: "GET", //静态页用get方法，否则服务器会抛出405错误
		//dataType: "json",
		//cache: false,
		//async: false,
		beforeSend: function(){
		 // Handle the beforeSend event
		},
		success: function(data){
			//er=data;
				if(data=='e1'){
					resetVerifyCode();
					tishicengjsqiuonclick('验证码填写错误','yzm');
					
					dxaaaadxaaaa();
					return false;
				}	if(data=='e2'){
					tishicengjsqiuonclick('手机号已经注册','yzm');
					dxaaaadxaaaa();
					return false;
				}if(data=='e3'){
					tishicengjsqiuonclick('邮箱已经注册','email');
					dxaaaadxaaaa();
					return false;
				}if(data=='e4'){
					tishicengjsqiuonclick('短信验证码填写错误','dxyzm');
					dxaaaadxaaaa();
					return false;
				}
				document.getElementById('myform').submit();
			//var result = $(data).find("另一个html页面的指定的一部分").html();
		}
	});
	
	
	
	
	
	

	
	//$('#cxhqdxyzm').attr("onclick","checkedformdx();");
	//$('#cxhqdxyzm').html('点击重新发送');
	
}
//短信发送按钮还原事件
function dxaaaadxaaaa(){
	$('#cxhqdxyzmcxhqdxyzm').attr("onclick","checkedform();");
	$('#cxhqdxyzmcxhqdxyzm').html('注 册');
}
function  youxiang(n){
	var email = document.getElementById(n).value;
	//alert(email);
	//return false;
	if (email != "") {
		var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
		isok= reg.test(email );
		if (!isok) {
			return false;
		}
		else return true;
	}
	return false;
}
</script>

<include file="Home:footer"/>
